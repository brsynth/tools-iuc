<tool id="rpExtractSink" name="Sink from SBML" version="5.11.1">
    <description>Generate the RetroPath2.0 sink file from an SBML input</description>
    <requirements>
        <requirement type="package" version="5.11.1">rptools</requirement>
    </requirements>
    <stdio>
		<regex match="Could not retreive any species in the compartment" level="fatal" />
	</stdio>
    <command detect_errors="exit_code"><![CDATA[
        #if str($input_strain_type.strain_type) == "BiGG":
            curl http://bigg.ucsd.edu/static/models/$(input_strain_type.input).xml.gz --output $(input_strain_type.input).xml.gz;
            python -m rptools.rpextractsink
                $(input_strain_type.input).xml.gz
        #else
            python -m rptools.rpextractsink
                $(input_strain_type.input)
        #end if
            '$sink'
            --compartment_id '$adv.compartment_id'
        #if str($adv.remove_dead_end) == "true":
            --remove_dead_end
        #end if
    ]]></command>
    <inputs>
        <conditional name="input_strain_type">
            <param name="strain_type" type="select" label="Input type">
                <option value="BiGG" selected="true">BiGG database</option>
                <option value="user">Custom file</option>
            </param>
            <when value="user">
                <param name="input" type="data" format="sbml" optional="false" label="Strain" />
            </when>
            <when value="BiGG">
                <param name="input" type="select" label="Strain">
                    <option value="iCN718">(iCN718) Acinetobacter baumannii AYE</option>
                    <option value="iYO844">(iYO844) Bacillus subtilis subsp. subtilis str. 168</option>
                    <option value="iRC1080">(iRC1080) Chlamydomonas reinhardtii</option>
                    <option value="iCN900">(iCN900) Clostridioides difficile 630</option>
                    <option value="iHN637">(iHN637) Clostridium ljungdahlii DSM 13528</option>
                    <option value="iCHOv1_DG44">(iCHOv1_DG44) Cricetulus griseus</option>
                    <option value="iCHOv1">(iCHOv1) Cricetulus griseus</option>
                    <option value="iAF1260b">(iAF1260b) Escherichia coli str. K-12 substr. MG1655</option>
                    <option value="iAF1260">(iAF1260) Escherichia coli str. K-12 substr. MG1655</option>
                    <option value="iML1515" selected="true">(iML1515) Escherichia coli str. K-12 substr. MG1655</option>
                    <option value="iJO1366">(iJO1366) Escherichia coli str. K-12 substr. MG1655</option>
                    <option value="iJR904">(iJR904) Escherichia coli str. K-12 substr. MG1655</option>
                    <option value="e_coli_core">(e_coli_core) Escherichia coli str. K-12 substr. MG1655</option>
                    <option value="iAF987">(iAF987) Geobacter metallireducens GS-15</option>
                    <option value="iIT341">(iIT341) Helicobacter pylori 26695</option>
                    <option value="iAT_PLT_636">(iAT_PLT_636) Homo sapiens</option>
                    <option value="Recon3D">(Recon3D) Homo sapiens</option>
                    <option value="iAB_RBC_283">(iAB_RBC_283) Homo sapiens</option>
                    <option value="RECON1">(RECON1) Homo sapiens</option>
                    <option value="iYL1228">(iYL1228) Klebsiella pneumoniae subsp. pneumoniae MGH 78578</option>
                    <option value="iNF517">(iNF517) Lactococcus lactis subsp. cremoris MG1363</option>
                    <option value="iAF692">(iAF692) Methanosarcina barkeri str. Fusaro</option>
                    <option value="iMM1415">(iMM1415) Mus musculus</option>
                    <option value="iNJ661">(iNJ661) Mycobacterium tuberculosis H37Rv</option>
                    <option value="iEK1008">(iEK1008) Mycobacterium tuberculosis H37Rv</option>
                    <option value="iLB1027_lipid">(iLB1027_lipid) Phaeodactylum tricornutum CCAP 1055/1</option>
                    <option value="iAM_Pb448">(iAM_Pb448) Plasmodium berghei</option>
                    <option value="iAM_Pc455">(iAM_Pc455) Plasmodium cynomolgi strain B</option>
                    <option value="iAM_Pf480">(iAM_Pf480) Plasmodium falciparum 3D7</option>
                    <option value="iAM_Pk459">(iAM_Pk459) Plasmodium knowlesi strain H</option>
                    <option value="iAM_Pv461">(iAM_Pv461) Plasmodium vivax Sal-1</option>
                    <option value="iJN746">(iJN746) Pseudomonas putida KT2440</option>
                    <option value="iJN1463">(iJN1463) Pseudomonas putida KT2440</option>
                    <option value="iND750">(iND750) Saccharomyces cerevisiae S288C</option>
                    <option value="iMM904">(iMM904) Saccharomyces cerevisiae S288C</option>
                    <option value="STM_v1_0">(STM_v1_0) Salmonella enterica subsp. enterica serovar Typhimurium str. LT2</option>
                    <option value="iYS1720">(iYS1720) Salmonella pan-reactome</option>
                    <option value="iSB619">(iSB619) Staphylococcus aureus subsp. aureus N315</option>
                    <option value="iYS854">(iYS854) Staphylococcus aureus subsp. aureus USA300_TCH1516</option>
                    <option value="iJB785">(iJB785) Synechococcus elongatus PCC 7942</option>
                    <option value="iJN678">(iJN678) Synechocystis sp. PCC 6803</option>
                    <option value="iSynCJ816">(iSynCJ816) Synechocystis sp. PCC 6803</option>
                    <option value="iLJ478">(iLJ478) Thermotoga maritima MSB8</option>
                    <option value="iIS312">(iIS312) Trypanosoma cruzi Dm28c</option>
                    <option value="iIS312_Trypomastigote">(iIS312_Trypomastigote) Trypanosoma cruzi Dm28c</option>
                    <option value="iIS312_Epimastigote">(iIS312_Epimastigote) Trypanosoma cruzi Dm28c</option>
                    <option value="iIS312_Amastigote">(iIS312_Amastigote) Trypanosoma cruzi Dm28c</option>
                </param>
            </when>
        </conditional>
        <!-- <param name="input" type="data" format="sbml" optional="false" label="SBML model" /> -->
        <section name="adv" title="Advanced Options" expanded="false">
            <param name="compartment_id" type="text" value="c" label="SBML compartment ID" />
            <param name="remove_dead_end" type="boolean" checked="true" label="Remove dead-end metabolites using FVA evaluation?" />
        </section>
    </inputs>
    <outputs>
        <data name="sink" format="csv" label="${tool.name} - ${input_strain_type.input}" />
    </outputs>
    <tests>
        <test>
        <!-- test 1: check if identical outputs are produced with default parameters  -->
            <conditional name="input_strain_type">
                <param name="strain_type" value="user"/>
                <param name="input" value="E.coli.sbml" />
            </conditional>
            <param name="compartment_id" value="MNXC3"/>
            <output name="sink" file="sink.csv" ftype="csv" compare="diff"/>
        </test>
    </tests>
    <help><![CDATA[

Sink from SBML
=================

Sink refers to the collection of chemical species used by the restrosynthesis algorithm of RetroPath2.0 to finish metabolic route exploration. This tool uses an SBML file of the desired chassis organism, parses all the molecules within a specified compartment (example: cytoplasm, Golgi apparatus, nucleus, etc) and uses its MIRIAM annotation to find their InChI structures. You can use "Remove dead-end metabolites using FVA evaluation? to conduct Flux Variability Analysis to remove metabolites that lack the requisite flux that would account for their production or consumption within the metabolic network.

In the advanced options, one can specify the compartment from which the tool will extract the chemical species. The default is MNXC3, the MetaNetX code for the cytoplasm. If the user wishes to upload an SBML file from another source, then this value must be changed.

The results are written to a RetroPath2.0 friendly CSV file format that can be used as sink input.


Input
-----

Required:

* **input_sbml**\ : (string) Path to the input SBML file

Advanced options:

* **remove_dead_end**\ : (boolean, default: True) Perform FVA evaluation to remove dead end metabolites
* **compartment_id**\ : (string, default: MNXC3) Specify the compartment from which to extract the sink molecules. The default are for MetaNetX files

Output
------

* **output_sink**\ : (string) Path to the output csv file


Project Links
---------------------

* `GitHub <https://github.com/brsynth/rptools>`_

Version
----------

5.9.2


Authors
-------


* **Melchior du Lac**
* Joan HÃ©risson

License
-------

`MIT <https://github.com/brsynth/rptools/blob/master/LICENSE>`_

Acknowledgments
---------------


* Thomas Duigou



    ]]></help>
    <citations>
        <citation type="bibtex">
@article{le2005minimum,
  title={Minimum information requested in the annotation of biochemical models (MIRIAM)},
  author={Le Nov{\`e}re, Nicolas and Finney, Andrew and Hucka, Michael and Bhalla, Upinder S and Campagne, Fabien and Collado-Vides, Julio and Crampin, Edmund J and Halstead, Matt and Klipp, Edda and Mendes, Pedro and others},
  journal={Nature biotechnology},
  volume={23},
  number={12},
  pages={1509--1515},
  year={2005},
  publisher={Nature Publishing Group}
}
        </citation>
        <citation type="bibtex">
@article{delepine2018retropath2,
  title={RetroPath2. 0: a retrosynthesis workflow for metabolic engineers},
  author={Del{\'e}pine, Baudoin and Duigou, Thomas and Carbonell, Pablo and Faulon, Jean-Loup},
  journal={Metabolic engineering},
  volume={45},
  pages={158--170},
  year={2018},
  publisher={Elsevier}}
        </citation>
        <citation type="bibtex">
@article{ebrahim2013cobrapy,
  title={COBRApy: COnstraints-based reconstruction and analysis for python},
  author={Ebrahim, Ali and Lerman, Joshua A and Palsson, Bernhard O and Hyduke, Daniel R},
  journal={BMC systems biology},
  volume={7},
  number={1},
  pages={74},
  year={2013},
  publisher={Springer}
}
        </citation>
        <citation type="bibtex">
@article{bornstein2008libsbml,
  title={LibSBML: an API library for SBML},
  author={Bornstein, Benjamin J and Keating, Sarah M and Jouraku, Akiya and Hucka, Michael},
  journal={Bioinformatics},
  volume={24},
  number={6},
  pages={880--881},
  year={2008},
  publisher={Oxford University Press}
}
        </citation>
    </citations>
</tool>