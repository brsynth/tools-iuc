<tool id="rpextractsink" name="Sink from SBML" version="@TOOL_VERSION@" profile="19.09">
    <description>Generate the RetroPath2.0 sink file from an SBML input</description>
    <macros>
        <token name="@TOOL_VERSION@">5.12.1</token>
    </macros>
    <requirements>
        <requirement type="package" version="@TOOL_VERSION@">rptools</requirement>
    </requirements>
    <stdio>
        <regex match="Could not retreive any species in the compartment" level="fatal" />
    </stdio>
    <command detect_errors="exit_code"><![CDATA[
        python -m rptools.rpextractsink
            '$input'
            '$sink'
            --compartment_id '$compartment_id'
        #if str($adv.remove_dead_end) == "true":
            --remove_dead_end
        #end if
    ]]></command>
    <inputs>
        <param name="input" type="data" format="xml" optional="false" label="Strain" />
        <param name="compartment_id" type="text" value="c" label="SBML compartment ID" >
            <validator type="empty_field" message="SBML compartment ID is required"/>
        </param>
        <section name="adv" title="Advanced Options" expanded="false">
            <param name="remove_dead_end" type="boolean" checked="true" label="Remove dead-end metabolites using FVA evaluation?" />
        </section>
    </inputs>
    <outputs>
        <data name="sink" format="csv" metadata_source="input" label="Sink - ${input.name}" />
    </outputs>
    <tests>
        <test>
        <!-- test 1: check if identical outputs are produced with iCN718 model input  -->
            <param name="input" value="iCN718.xml.gz" />
            <output name="sink" file="sink.csv" ftype="csv" compare="diff"/>
        </test>
    </tests>
    <help><![CDATA[

Sink from SBML
=================

Sink refers to the collection of chemical species used by the restrosynthesis algorithm of RetroPath2.0 to finish metabolic route exploration. This tool uses an SBML file of the desired chassis organism, parses all the molecules within a specified compartment (example: cytoplasm, Golgi apparatus, nucleus, etc) and uses its MIRIAM annotation to find their InChI structures. You can use "Remove dead-end metabolites using FVA evaluation? to conduct Flux Variability Analysis to remove metabolites that lack the requisite flux that would account for their production or consumption within the metabolic network.

In the advanced options, one can specify the compartment from which the tool will extract the chemical species. The default is 'c', the BiGG code for the cytoplasm. If the user wishes to upload an SBML file from another source, then this value must be changed.

The results are written to a RetroPath2.0 friendly CSV file format that can be used as sink input.


Input
-----

Required:

* **input_sbml**\ : (string) Path to the input SBML file
* **compartment_id**\ : (string, default: c) Specify the compartment from which to extract the sink molecules. The default are for BiGG models

Advanced options:

* **remove_dead_end**\ : (boolean, default: True) Perform FVA evaluation to remove dead end metabolites

Output
------

* **output_sink**\ : (string) Path to the output csv file

Project Links
---------------------

* `GitHub <https://github.com/brsynth/rptools>`_

Version
----------

5.12.1

Authors
-------

* **Melchior du Lac**
* Joan HÃ©risson

License
-------

`MIT <https://github.com/brsynth/rptools/blob/master/LICENSE>`_

Acknowledgments
---------------

* Thomas Duigou

    ]]></help>
    <citations>
        <citation type="doi">10.1038/nbt1156</citation>
        <citation type="doi">10.1016/j.ymben.2017.12.002</citation>
        <citation type="doi">10.1186/1752-0509-7-74</citation>
        <citation type="doi">10.1093/bioinformatics/btn051</citation>
    </citations>
</tool>